@{
    Layout = "~/Views/Shared/_ThemeLayout.cshtml";
}
<div class="container">
    <h2 class="mt-4 mb-3">Danh Sách Nhân Viên</h2>

    <!-- Form Thêm Nhân Viên -->
    <div class="card mb-4">
        <div class="card-header">Thêm Nhân Viên</div>
        <div class="card-body">
            <form id="addEmployeeForm">
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Họ Tên</label>
                        <input type="text" class="form-control" id="hoTen" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Ngày Sinh</label>
                        <input type="date" class="form-control" id="ngaySinh">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Giới Tính</label>
                        <select class="form-control" id="gioiTinh">
                            <option value="true">Nam</option>
                            <option value="false">Nữ</option>
                        </select>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label class="form-label">SĐT</label>
                        <input type="text" class="form-control" id="sdt" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Trình Độ Học Vấn</label>
                        <input type="text" class="form-control" id="trinhDoHocVan">
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <label class="form-label">Mã Phòng Ban</label>
                        <input type="number" class="form-control" id="maPhongBan" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Mã Chức Vụ</label>
                        <input type="number" class="form-control" id="maChucVu" required>
                    </div>
                </div>

                <button type="submit" class="btn btn-success mt-3">Thêm Nhân Viên</button>
            </form>
        </div>
    </div>

    <!-- Danh Sách Nhân Viên -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Họ Tên</th>
                <th>Ngày Sinh</th>
                <th>Giới Tính</th>
                <th>SĐT</th>
                <th>Email</th>
                <th>Hành Động</th>
            </tr>
        </thead>
        <tbody id="employeeTable">
            <!-- Dữ liệu sẽ được tải từ API -->
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadEmployees();

        // Xử lý sự kiện submit form thêm nhân viên
        document.getElementById("addEmployeeForm").addEventListener("submit", function (event) {
            event.preventDefault();
            addEmployee();
        });
    });

    function loadEmployees() {
        fetch('/api/EmployeesApi')
            .then(response => response.json())
            .then(data => {
                let tableContent = "";
                data.forEach(employee => {
                    tableContent += `
                            <tr>
                                <td>${employee.maNv}</td>
                                <td>${employee.hoTen}</td>
                                <td>${employee.ngaySinh}</td>
                                <td>${employee.gioiTinh}</td>
                                <td>${employee.sdt}</td>
                                <td>${employee.email}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${employee.maNv})">
                                        <i class="fa fa-trash"></i> Xóa
                                    </button>
                                </td>
                            </tr>`;
                });
                document.getElementById("employeeTable").innerHTML = tableContent;
            })
            .catch(error => console.error('Lỗi:', error));
    }

    function addEmployee() {
        let employeeData = {
            hoTen: document.getElementById("hoTen").value,
            ngaySinh: document.getElementById("ngaySinh").value,
            gioiTinh: document.getElementById("gioiTinh").value === "true",
            sdt: document.getElementById("sdt").value,
            email: document.getElementById("email").value,
            trinhDoHocVan: document.getElementById("trinhDoHocVan").value,
            maPhongBan: parseInt(document.getElementById("maPhongBan").value),
            maChucVu: parseInt(document.getElementById("maChucVu").value)
        };

        fetch("/api/EmployeesApi", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(employeeData)
        })
            .then(response => {
                if (response.ok) {
                    Swal.fire("Thành công!", "Nhân viên đã được thêm.", "success");
                    loadEmployees();  // Cập nhật danh sách
                    document.getElementById("addEmployeeForm").reset();
                } else {
                    Swal.fire("Lỗi!", "Không thể thêm nhân viên.", "error");
                }
            })
            .catch(error => {
                Swal.fire("Lỗi!", "Hệ thống gặp vấn đề.", "error");
                console.error("Lỗi khi thêm nhân viên:", error);
            });
    }

    function deleteEmployee(id) {
        Swal.fire({
            title: "Bạn có chắc muốn xóa?",
            text: "Dữ liệu sẽ không thể khôi phục!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Xóa",
            cancelButtonText: "Hủy"
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`/api/EmployeesApi/${id}`, { method: "DELETE" })
                    .then(response => {
                        if (response.ok) {
                            Swal.fire("Xóa thành công!", "", "success");
                            loadEmployees();
                        } else {
                            Swal.fire("Lỗi khi xóa!", "", "error");
                        }
                    });
            }
        });
    }
</script>
