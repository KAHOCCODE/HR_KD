@{
    Layout = "~/Views/Shared/_ThemeLayout.cshtml";
}

<div id="attendanceSection" class="dashboard-card bg-white p-4">
    <h5 class="mb-4 text-primary"><i class="fas fa-fingerprint me-2"></i>Chấm công</h5>
    <div class="mb-3">
        <label class="form-label">Chọn chế độ chấm công</label>
        <select class="form-select mb-3" id="attendanceMode" onchange="toggleAttendanceMode()">
            <option value="daily">Theo ngày</option>
            <option value="weekly">Theo tuần</option>
        </select>
    </div>
    <div id="dailyMode" class="mb-3">
        <label class="form-label">Chọn ngày</label>
        <input type="date" class="form-control" id="attendanceDate" value="2025-03-04">
    </div>
    <div id="weeklyMode" class="mb-3" style="display: none;">
        <label class="form-label">Chọn tuần</label>
        <input type="week" class="form-control" id="attendanceWeek">
        <div class="row mt-3">
            <div class="col-md-6">
                <label class="form-label">Giờ check-in</label>
                <input type="time" class="form-control" id="checkInTime">
            </div>
            <div class="col-md-6">
                <label class="form-label">Giờ check-out</label>
                <input type="time" class="form-control" id="checkOutTime">
            </div>
        </div>
    </div>

    <div id="attendanceStatus" class="mb-3">
        <p class="text-muted">Trạng thái hiện tại: <span class="fw-bold text-success">Đang làm việc</span></p>
    </div>
    <button class="btn btn-primary w-100" onclick="checkInOut()">
        <i class="fas fa-check-circle me-2"></i>
        <span id="checkBtnText">Check-in</span>
    </button>
    <div class="mt-3 text-center">
        <small class="text-muted" id="lastCheckTime">Lần cuối: 08:00 04/03/2025</small>
    </div>
</div>

<script>
    // Xử lý chấm công
    function checkInOut() {
        const btn = $('#checkBtnText');
        const status = $('#attendanceStatus');
        const time = $('#lastCheckTime');

        if (btn.text() === 'Check-in') {
            btn.text('Check-out');
            status.html('<p class="text-muted">Trạng thái hiện tại: <span class="fw-bold text-danger">Đã kết thúc</span></p>');
            time.text('Lần cuối: ' + new Date().toLocaleString());
        } else {
            btn.text('Check-in');
            status.html('<p class="text-muted">Trạng thái hiện tại: <span class="fw-bold text-success">Đang làm việc</span></p>');
            time.text('Lần cuối: ' + new Date().toLocaleString());
        }
    }

    // Hiển thị giao diện chấm công theo ngày/tuần
    function toggleAttendanceMode() {
        const mode = $('#attendanceMode').val();
        if (mode === 'daily') {
            $('#dailyMode').show();
            $('#weeklyMode').hide();
            $('#checkBtnText').text('Check-in'); // Đổi lại nút thành Check-in
        } else {
            $('#dailyMode').hide();
            $('#weeklyMode').show();
            $('#checkBtnText').text('Submit'); // Đổi nút thành Submit
        }
    }

    // Xử lý khi nhấn nút Submit trong chế độ tuần
    function checkInOut() {
        const mode = $('#attendanceMode').val();
        if (mode === 'weekly') {
            const week = $('#attendanceWeek').val();
            const checkInTime = $('#checkInTime').val();
            const checkOutTime = $('#checkOutTime').val();

            if (!week || !checkInTime || !checkOutTime) {
                alert('Vui lòng điền đầy đủ thông tin!');
                return;
            }

            // Thêm dữ liệu vào lịch sử chấm công
            const status = checkOutTime ? 'Hoàn thành' : 'Thiếu check-out';
            $('#attendanceHistory').append(`
                <tr>
                    <td>${week}</td>
                    <td>${checkInTime}</td>
                    <td>${checkOutTime}</td>
                    <td>${calculateTotalTime(checkInTime, checkOutTime)}</td>
                    <td>${status}</td>
                </tr>
            `);

            alert('Đã gửi thông tin chấm công tuần thành công!');
        } else {
            // Xử lý chấm công theo ngày
            const btn = $('#checkBtnText');
            const status = $('#attendanceStatus');
            const time = $('#lastCheckTime');

            if (btn.text() === 'Check-in') {
                btn.text('Check-out');
                status.html('<p class="text-muted">Trạng thái hiện tại: <span class="fw-bold text-danger">Đã kết thúc</span></p>');
                time.text('Lần cuối: ' + new Date().toLocaleString());
            } else {
                btn.text('Check-in');
                status.html('<p class="text-muted">Trạng thái hiện tại: <span class="fw-bold text-success">Đang làm việc</span></p>');
                time.text('Lần cuối: ' + new Date().toLocaleString());
            }
        }
    }

    // Hàm tính tổng thời gian làm việc
    function calculateTotalTime(checkInTime, checkOutTime) {
        if (!checkInTime || !checkOutTime) return 'N/A';
        const [inHour, inMinute] = checkInTime.split(':').map(Number);
        const [outHour, outMinute] = checkOutTime.split(':').map(Number);
        const totalMinutes = (outHour * 60 + outMinute) - (inHour * 60 + inMinute);
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        return `${hours} giờ ${minutes} phút`;
    }
</script>
